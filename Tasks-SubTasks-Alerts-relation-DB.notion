/* v5.1 - Task Version (DB)
oem at oemden dot com
- Needs a relation to Alert_level-DB ->

-> Alert_level-DB:
			|Alert_level(Name)|Setting(Select)|Description(text - optionnal)|
			|Projects|All Alerts|Displays All Messages [KO + OK]

Settings is a 'Select' Property with 3 'Options':
â€¢ All Alerts
â€¢ Alerts
â€¢ No Alerts

To display:
		â€¢ ONLY [KO] Status, set Option to empty "Alerts"
		â€¢ ALL Status [KO & OK], set ALL_Cases to "All Alerts"
		â€¢ No Status [KO & OK], set ALL_Cases to "No Alerts"
*/

lets (

	 ALL_Cases,
	"",

	Task_sans_sub_sans_Project, /* Case1 */
	prop("Sub-task").empty() and prop("Projects").empty() and prop("Parent task").empty(),

	Task_sans_sub_avec_Project,  /* Case 6 */
	prop("Sub-task").empty() and prop("Projects").empty().not() and prop("Parent task").empty(),

	Task_avec_sub, /* intermediary */
	prop("Sub-task").empty().not(),

	Sub_sans_Project, /*intermediary */
	prop("Sub-task").filter(current.prop("Projects").empty()),

	Task_avec_sub_sans_Project,
	Task_avec_sub == true and Sub_sans_Project == true,

	TaskSub_sans_Project, /* Case 2 */
	prop("Parent task").empty().not() and prop("Projects").empty(),

	Sub_avec_Project, /* Case 3 */
	prop("Parent task").empty().not() and prop("Projects").empty().not(),

	Alert_Settings,
	prop("Alerts Level").map(current.prop("Setting")).format(),

	Alert_Settings_none,
	Alert_Settings == "No Alerts",

	Alert_Settings_all,
	Alert_Settings  == "All Alerts",

	Alert_Settings_std,
	Alert_Settings == "Alerts",

	/*
	Show Alerts == "No Alerts" -> nothing
	Show Alerts == "ALL" -> ALL Alerts KO & OK
	Show Alerts == "Alerts" -> Just KO
	*/

	ifs( /* if1 */
		Alert_Settings_none,
		"",

		Alert_Settings_all,
			ifs(
				/* Case1: Standalone Task With No Sub-Task and No Task: Alert*/
				Task_sans_sub_sans_Project == true, (" ðŸš¨ This Task has No Project assigned ! ").style("b", "red", "red_background"),

				/* Case 2: Sub-Task with No Task: Alert */
				TaskSub_sans_Project == true, (" ðŸš¨ This Sub-Task has No Project assigned ! ").style("b", "pink", "pink_background"),

				/* Case 4: main Task has one or more Sub-Task with No Task assigned */
				Task_avec_sub == true and prop("Sub-task").filter(current.prop("Projects").empty()), (" ðŸš¨Â One or more Sub-Task has no Project assigned ! ").style("b", "red", "red_background"),

				/* Case 3: Sub Task has Project Assigned */
        Sub_avec_Project == true, (" âœ… This Sub-Task has Project Assigned ! ").style("b", "blue", "blue_background"),

      	/* Case 5: Main Task has all Sub-Tasks with Task assigned */
    		Task_avec_sub == true and prop("Sub-task").filter(current.prop("Projects").empty().not()), (" âœ…Â All Sub-Tasks have Project assigned! ").style("b", "green", "green_background"),

    		/* Case 6: Standalone Task with no sub-Task AND Project Assigned */
    		Task_sans_sub_avec_Project == true, (" âœ…Â This Task has Project assigned!").style("b", "green", "green_background")
			),

		Alert_Settings_std,
			ifs(
					/* Case1: Standalone Task With No Sub-Task and No Task: Alert*/
					Task_sans_sub_sans_Project == true, (" ðŸš¨ This Task has No Project assigned ! ").style("b", "red", "red_background"),

					/* Case 2: Sub-Task with No Task: Alert */
					TaskSub_sans_Project == true, (" ðŸš¨ This Sub-Task has No Project assigned ! ").style("b", "pink", "pink_background"),

					/* Case 4: main Task has one or more Sub-Task with No Task assigned */
					Task_avec_sub == true and prop("Sub-task").filter(current.prop("Projects").empty()), (" ðŸš¨Â One or more Sub-Task has no Project assigned ! ").style("b", "red", "red_background")
				)


		) /* if1 */
)
